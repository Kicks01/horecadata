<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Horeca Ø§Ù„Ø´Ø§Ù…Ù„ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            color: #fafafa;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #fafafa;
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .header p {
            color: #a1a1aa;
            font-size: 1.1rem;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .stat-card h3 {
            color: #a1a1aa;
            font-size: 0.85rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-card .value {
            color: #fafafa;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .segment-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .segment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .segment-header h2 {
            color: #fafafa;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .customers-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .customers-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            overflow: hidden;
        }

        .customers-table thead {
            background: rgba(255, 255, 255, 0.1);
        }

        .customers-table th {
            padding: 15px;
            text-align: right;
            color: #fafafa;
            font-weight: 700;
            font-size: 0.9rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .customers-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #e4e4e7;
            font-size: 0.9rem;
        }

        .customers-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .customer-detail-row {
            background: rgba(255, 255, 255, 0.02);
        }

        .customer-detail-row td {
            padding: 20px;
        }

        .customer-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .detail-group {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .detail-group h4 {
            color: #a1a1aa;
            font-size: 0.85rem;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-item {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
        }

        .detail-item label {
            color: #71717a;
            font-size: 0.85rem;
        }

        .detail-item .value {
            color: #fafafa;
            font-weight: 600;
        }

        .toggle-details {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }

        .toggle-details:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-premium {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .badge-standard {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .badge-low {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .customer-segment-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-align: center;
        }

        .search-filter {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fafafa;
            font-size: 0.9rem;
            font-family: 'Cairo', sans-serif;
        }

        .search-input::placeholder {
            color: #71717a;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pagination button {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
        }

        .pagination button:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .pagination button.active {
            background: rgba(59, 130, 246, 0.5);
            border-color: rgba(59, 130, 246, 0.8);
            color: #ffffff;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .page-info {
            color: #a1a1aa;
            font-size: 0.9rem;
            padding: 8px 12px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .product-item {
            background: rgba(255, 255, 255, 0.02);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.8rem;
        }

        .product-name {
            color: #fafafa;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .product-count {
            color: #60a5fa;
            font-size: 0.75rem;
        }

        .brands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .brand-item {
            background: rgba(255, 255, 255, 0.02);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.8rem;
        }

        .brand-name {
            color: #fafafa;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .brand-count {
            color: #4ade80;
            font-size: 0.75rem;
        }

        .expandable-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.02);
        }

        .section-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .section-title {
            color: #fafafa;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .section-toggle {
            color: #60a5fa;
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .expandable-section.expanded .section-toggle {
            transform: rotate(90deg);
        }

        .section-content {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-content.hidden {
            display: none;
        }

        .order-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(59, 130, 246, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #60a5fa;
        }

        .order-header:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .order-id-date {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .order-label {
            color: #71717a;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .order-value {
            color: #fafafa;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .expand-arrow {
            color: #60a5fa;
            transition: transform 0.3s ease;
            font-size: 0.75rem;
            margin-left: 10px;
        }

        .order-container.expanded .expand-arrow {
            transform: rotate(180deg);
        }

        .order-items-container {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.01);
        }

        .order-items-container.hidden {
            display: none;
        }

        .order-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            font-size: 0.85rem;
            border-left: 3px solid rgba(59, 130, 246, 0.5);
        }

        .item-field {
            display: flex;
            flex-direction: column;
        }

        .item-label {
            color: #71717a;
            font-size: 0.75rem;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .item-value {
            color: #fafafa;
            font-weight: 600;
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hidden {
            display: none;
        }

        .group-table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .group-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            overflow: hidden;
        }

        .group-table thead {
            background: rgba(255, 255, 255, 0.1);
        }

        .group-table th {
            padding: 12px 15px;
            text-align: right;
            color: #fafafa;
            font-weight: 700;
            font-size: 0.85rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .group-table td {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #e4e4e7;
            font-size: 0.85rem;
        }

        .group-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .segment-distribution {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .segment-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .segment-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .segment-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .segment-badge-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .segment-card h4 {
            color: #fafafa;
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 3px;
        }

        .segment-card-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .segment-card-stat label {
            color: #a1a1aa;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .segment-card-stat .value {
            color: #fafafa;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .segment-card-stat .percentage {
            color: #60a5fa;
            font-weight: 600;
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            .segment-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .customers-table {
                font-size: 0.8rem;
            }
            .customers-table td, .customers-table th {
                padding: 8px;
            }
            .customer-details {
                grid-template-columns: 1fr;
            }
            .order-item {
                grid-template-columns: 1fr;
            }
            .segment-distribution {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Horeca Ø§Ù„Ø´Ø§Ù…Ù„ ÙˆØ§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
            <p>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø¹ ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</p>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                <div class="value">1551</div>
            </div>
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (GMV)</h3>
                <div class="value">161,388,984 EGP</div>
            </div>
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©</h3>
                <div class="value">22,883</div>
            </div>
            <div class="stat-card">
                <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©</h3>
                <div class="value">6,540</div>
            </div>
            <div class="stat-card">
                <h3>Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</h3>
                <div class="value">977</div>
            </div>
        </div>

        <div class="stats-overview">
            <div class="stat-card">
                <h3>Ù…ØªÙˆØ³Ø· GMV Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„</h3>
                <div class="value">104,055 EGP</div>
            </div>
            <div class="stat-card">
                <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„</h3>
                <div class="value">14.8</div>
            </div>
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù…Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±)</h3>
                <div class="value">149,445</div>
            </div>
            <div class="stat-card">
                <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h3>
                <div class="value">162</div>
            </div>
            <div class="stat-card">
                <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ù†</h3>
                <div class="value">28</div>
            </div>
        </div>

        <div class="segment-section">
            <div class="segment-header">
                <h2>ï¿½ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Ø£ÙØ¶Ù„ 10 Ø¹Ù…Ù„Ø§Ø¡ Ù„ÙƒÙ„ Ù…Ù†Ø·Ù‚Ø©)</h2>
            </div>
            <div class="group-table-container">
                <table class="group-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ GMV</th>
                            <th>Ù…ØªÙˆØ³Ø· GMV Ù„Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø£ÙØ¶Ù„ Ø¹Ù…ÙŠÙ„</th>
                            <th>GMV Ø£ÙØ¶Ù„ Ø¹Ù…ÙŠÙ„</th>
                        </tr>
                    </thead>
                    <tbody id="areaTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="segment-section">
            <div class="segment-header">
                <h2>ğŸ™ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø£ÙØ¶Ù„ 50 Ø¹Ù…ÙŠÙ„ Ù„ÙƒÙ„ Ù…Ø¯ÙŠÙ†Ø©)</h2>
            </div>
            <div class="group-table-container">
                <table class="group-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ GMV</th>
                            <th>Ù…ØªÙˆØ³Ø· GMV Ù„Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø£ÙØ¶Ù„ Ø¹Ù…ÙŠÙ„</th>
                            <th>GMV Ø£ÙØ¶Ù„ Ø¹Ù…ÙŠÙ„</th>
                        </tr>
                    </thead>
                    <tbody id="cityTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="segment-section">
            <div class="segment-header">
                <h2>ğŸ“ˆ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</h2>
            </div>
            <div class="segment-distribution" id="segmentDistribution">
            </div>
        </div>

        <div class="segment-section">
            <div class="segment-header">
                <h2>ï¿½ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
            </div>
            <div class="search-filter">
                <input type="text" class="search-input" id="customerSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„...">
            </div>
            <div class="customers-table-container">
                <table class="customers-table" id="customersTable">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                            <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ GMV</th>
                            <th>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©</th>
                            <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                        </tr>
                    </thead>
                    <tbody id="customersTableBody">
                    </tbody>
                </table>
            </div>
            <div class="pagination" id="paginationContainer"></div>
        </div>
    </div>

    <script src="dashboard_data.js"></script>
    <script>
        const itemsPerPage = 25;
        let currentPage = 1;
        let filteredData = [];

        // Initialize data from external file
        function initializeData() {
            try {
                // Check if data is loaded from external script
                // The variables are defined as const in dashboard_data.js
                if (typeof customersData !== 'undefined' && Array.isArray(customersData) && customersData.length > 0) {
                    // Data is already loaded, just set filteredData
                    filteredData = [...customersData];
                    return true;
                }
            } catch (e) {
                // Variables not loaded yet
            }
            return false;
        }

        // Wait for data to load
        function waitForDataAndRender() {
            if (initializeData()) {
                renderAreaGroupsTable();
                renderCityGroupsTable();
                renderSegmentDistribution();
                renderTable();
            } else {
                setTimeout(waitForDataAndRender, 100);
            }
        }

        // Render Area Groups Table
        function renderAreaGroupsTable() {
            const tbody = document.getElementById('areaTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';
            
            if (!areaGroupsData || areaGroupsData.length === 0) return;
            
            areaGroupsData.forEach(area => {
                const row = document.createElement('tr');
                const avgGmv = area.customers.length > 0 ? area.gmv / area.customers.length : 0;
                const topCustomer = area.customers.length > 0 ? area.customers[0] : null;
                
                row.innerHTML = `
                    <td>${area.name}</td>
                    <td>${area.customers.length}</td>
                    <td>${area.gmv.toLocaleString('ar')} EGP</td>
                    <td>${avgGmv.toLocaleString('ar', {maximumFractionDigits: 0})} EGP</td>
                    <td>${topCustomer ? topCustomer.name : 'N/A'}</td>
                    <td>${topCustomer ? topCustomer.total_gmv.toLocaleString('ar') : '0'} EGP</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render City Groups Table
        function renderCityGroupsTable() {
            const tbody = document.getElementById('cityTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';
            
            if (!cityGroupsData || cityGroupsData.length === 0) return;
            
            cityGroupsData.forEach(city => {
                const row = document.createElement('tr');
                const avgGmv = city.customers.length > 0 ? city.gmv / city.customers.length : 0;
                const topCustomer = city.customers.length > 0 ? city.customers[0] : null;
                
                row.innerHTML = `
                    <td>${city.name}</td>
                    <td>${city.customers.length}</td>
                    <td>${city.gmv.toLocaleString('ar')} EGP</td>
                    <td>${avgGmv.toLocaleString('ar', {maximumFractionDigits: 0})} EGP</td>
                    <td>${topCustomer ? topCustomer.name : 'N/A'}</td>
                    <td>${topCustomer ? topCustomer.total_gmv.toLocaleString('ar') : '0'} EGP</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render Segment Distribution Cards
        function renderSegmentDistribution() {
            const container = document.getElementById('segmentDistribution');
            if (!container) return;
            container.innerHTML = '';
            
            if (!segmentsData || segmentsData.length === 0) return;
            
            const totalCustomers = customersData.length;
            
            segmentsData.forEach(segment => {
                const percentage = ((segment.count / totalCustomers) * 100).toFixed(1);
                const card = document.createElement('div');
                card.className = 'segment-card';
                card.innerHTML = `
                    <div class="segment-card-header">
                        <div class="segment-badge-color" style="background-color: ${segment.color};"></div>
                        <div>
                            <h4>${segment.name}</h4>
                        </div>
                    </div>
                    <div class="segment-card-stat">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</label>
                        <div class="value">${segment.count}</div>
                    </div>
                    <div class="segment-card-stat">
                        <label>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</label>
                        <div class="percentage">${percentage}%</div>
                    </div>
                    <div class="segment-card-stat">
                        <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ GMV</label>
                        <div class="value" style="font-size: 0.95rem;">${segment.gmv.toLocaleString('ar', {maximumFractionDigits: 0})} EGP</div>
                    </div>
                    <div class="segment-card-stat">
                        <label>Ù…ØªÙˆØ³Ø· GMV</label>
                        <div class="value" style="font-size: 0.95rem;">${(segment.gmv / segment.count).toLocaleString('ar', {maximumFractionDigits: 0})} EGP</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderTable() {
            const tbody = document.getElementById('customersTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            if (!filteredData || filteredData.length === 0) return;

            const startIdx = (currentPage - 1) * itemsPerPage;
            const endIdx = startIdx + itemsPerPage;
            const pageData = filteredData.slice(startIdx, endIdx);

            pageData.forEach((customer, idx) => {
                const globalIdx = startIdx + idx;
                
                // Main row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td><span class="customer-segment-badge" style="background: ${customer.segment_color}40; color: ${customer.segment_color}; border: 1px solid ${customer.segment_color};">${customer.segment}</span></td>
                    <td>${customer.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td><span class="badge badge-premium">${customer.type}</span></td>
                    <td>${customer.city}</td>
                    <td>${customer.area}</td>
                    <td>${customer.total_gmv.toLocaleString('ar')} EGP</td>
                    <td>${customer.unique_orders}</td>
                    <td><button class="toggle-details" onclick="toggleDetails(${globalIdx})">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button></td>
                `;
                tbody.appendChild(row);

                // Detail row
                const detailRow = document.createElement('tr');
                detailRow.className = 'customer-detail-row hidden';
                detailRow.id = `detail-${globalIdx}`;
                
                const productsHtml = Object.entries(customer.products)
                    .sort((a, b) => b[1] - a[1])
                    .map(([prod, count]) => `<div class="product-item"><div class="product-name">${prod}</div><div class="product-count">Ø·Ù„Ø¨Ø§Øª: ${count}</div></div>`)
                    .join('');

                const brandsHtml = Object.entries(customer.brands)
                    .sort((a, b) => b[1] - a[1])
                    .map(([brand, count]) => `<div class="brand-item"><div class="brand-name">${brand}</div><div class="brand-count">Ø·Ù„Ø¨Ø§Øª: ${count}</div></div>`)
                    .join('');

                const ordersHtml = customer.orders.slice(0, 30).map((order, orderIdx) => `
                    <div class="order-container">
                        <div class="order-header" onclick="toggleOrderItems(${globalIdx}, ${orderIdx}, event)">
                            <div class="order-id-date">
                                <div class="order-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</div>
                                <div class="order-value">${order.order_id}</div>
                                <div class="order-label" style="margin-right: 20px;">Ø§Ù„ØªØ§Ø±ÙŠØ®:</div>
                                <div class="order-value">${order.date}</div>
                            </div>
                            <div class="expand-arrow" id="arrow-${globalIdx}-${orderIdx}">â–¼</div>
                        </div>
                        <div class="order-items-container hidden" id="items-${globalIdx}-${orderIdx}">
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <div class="item-field">
                                        <div class="item-label">Ø§Ù„Ù…Ù†ØªØ¬</div>
                                        <div class="item-value">${item.product}</div>
                                    </div>
                                    <div class="item-field">
                                        <div class="item-label">Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</div>
                                        <div class="item-value">${item.brand}</div>
                                    </div>
                                    <div class="item-field">
                                        <div class="item-label">Ø§Ù„ÙƒÙ…ÙŠØ©</div>
                                        <div class="item-value">${item.quantity}</div>
                                    </div>
                                    <div class="item-field">
                                        <div class="item-label">Ø§Ù„Ø³Ø¹Ø±</div>
                                        <div class="item-value">${item.price} EGP</div>
                                    </div>
                                    <div class="item-field">
                                        <div class="item-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                                        <div class="item-value">${item.total.toLocaleString('ar')} EGP</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

                detailRow.innerHTML = `
                    <td colspan="9">
                        <div class="customer-details">
                            <div class="detail-group">
                                <h4>ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
                                <div class="detail-item">
                                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                                    <span class="value">${customer.name}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                                    <span class="value" style="color: ${customer.segment_color};">â— ${customer.segment}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø§Ù„Ø³Ø¨Ø¨:</label>
                                    <span class="value">${customer.segment_reason}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                                    <span class="value">${customer.phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                                    <span class="value">${customer.city}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label>
                                    <span class="value">${customer.area}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                                    <span class="value">${customer.type}</span>
                                </div>
                            </div>

                            <div class="detail-group">
                                <h4>ğŸ’° Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h4>
                                <div class="detail-item">
                                    <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ GMV:</label>
                                    <span class="value">${customer.total_gmv.toLocaleString('ar')} EGP</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©:</label>
                                    <span class="value">${customer.unique_orders}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø©:</label>
                                    <span class="value">${customer.item_count}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨:</label>
                                    <span class="value">${customer.avg_order_value.toLocaleString('ar')} EGP</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©:</label>
                                    <span class="value">${customer.unique_products}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©:</label>
                                    <span class="value">${customer.unique_brands}</span>
                                </div>
                                <div class="detail-item">
                                    <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡:</label>
                                    <span class="value">${customer.unique_dates}</span>
                                </div>
                            </div>
                        </div>

                        <div class="expandable-section" onclick="toggleSection(this, event)">
                            <div class="section-header">
                                <span class="section-title">ğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${Object.keys(customer.products).length} Ù…Ù†ØªØ¬)</span>
                                <span class="section-toggle">â–¶</span>
                            </div>
                            <div class="section-content hidden">
                                <div class="products-grid">
                                    ${productsHtml}
                                </div>
                            </div>
                        </div>

                        <div class="expandable-section" onclick="toggleSection(this, event)">
                            <div class="section-header">
                                <span class="section-title">ğŸ·ï¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© Ø§Ù„Ù…ÙØ¶Ù„Ø© (${Object.keys(customer.brands).length} Ø¹Ù„Ø§Ù…Ø©)</span>
                                <span class="section-toggle">â–¶</span>
                            </div>
                            <div class="section-content hidden">
                                <div class="brands-grid">
                                    ${brandsHtml}
                                </div>
                            </div>
                        </div>

                        <div class="expandable-section" onclick="toggleSection(this, event)">
                            <div class="section-header">
                                <span class="section-title">ğŸ“¦ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (${customer.unique_orders} Ø·Ù„Ø¨) ${customer.unique_orders > 30 ? '- Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 30' : ''}</span>
                                <span class="section-toggle">â–¶</span>
                            </div>
                            <div class="section-content hidden">
                                <div class="orders-list">
                                    ${ordersHtml}
                                </div>
                                ${customer.unique_orders > 30 ? `<div style="color: #a1a1aa; margin-top: 15px; font-size: 0.85rem;">... Ùˆ ${customer.unique_orders - 30} Ø·Ù„Ø¨ Ø¢Ø®Ø±</div>` : ''}
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(detailRow);
            });

            renderPagination();
        }

        function renderPagination() {
            const container = document.getElementById('paginationContainer');
            container.innerHTML = '';

            const totalPages = Math.ceil(filteredData.length / itemsPerPage);

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'â† Ø§Ù„Ø³Ø§Ø¨Ù‚';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            };
            container.appendChild(prevBtn);

            const pageInfo = document.createElement('span');
            pageInfo.className = 'page-info';
            pageInfo.textContent = `Ø§Ù„ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}`;
            container.appendChild(pageInfo);

            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Ø§Ù„ØªØ§Ù„ÙŠ â†’';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            };
            container.appendChild(nextBtn);
        }

        function toggleDetails(idx) {
            const detailRow = document.getElementById(`detail-${idx}`);
            if (detailRow) {
                detailRow.classList.toggle('hidden');
            }
        }

        function toggleSection(element, event) {
            if (event) {
                event.stopPropagation();
            }
            const section = element.closest('.expandable-section');
            const content = section.querySelector('.section-content');
            section.classList.toggle('expanded');
            content.classList.toggle('hidden');
        }

        function toggleOrderItems(customerIdx, orderIdx, event) {
            if (event) {
                event.stopPropagation();
            }
            const container = document.getElementById(`items-${customerIdx}-${orderIdx}`);
            const arrow = document.getElementById(`arrow-${customerIdx}-${orderIdx}`);
            const orderContainer = container.closest('.order-container');
            
            container.classList.toggle('hidden');
            arrow.style.transform = container.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
            orderContainer.classList.toggle('expanded');
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('customerSearch');
            if (searchInput) {
                searchInput.addEventListener('keyup', function(e) {
                    const value = e.target.value.toLowerCase();
                    filteredData = customersData.filter(customer => 
                        customer.name.toLowerCase().includes(value) ||
                        String(customer.phone || '').toLowerCase().includes(value) ||
                        customer.city.toLowerCase().includes(value)
                    );
                    currentPage = 1;
                    renderTable();
                });
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                waitForDataAndRender();
                setupSearch();
            });
        } else {
            waitForDataAndRender();
            setupSearch();
        }
    </script>
</body>
</html>
